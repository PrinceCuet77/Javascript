# Single Threaded in JS

- JavaScript is single threaded but can use like multi-threaded
- Parallelism is used by multi-threaded language
- **Browser will freeze in CPU intensive work**
- For Example:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Worker API</title>
  </head>
  <body>
    <button id="total">Calculate Total</button>
    <button id="bg">Change Background Color</button>

    <script src="./script.js"></script>
  </body>
</html>
```

- JS file:

```js
const totalButton = document.getElementById('total');
const bgButton = document.getElementById('bg');

totalButton.addEventListener('click', () => {
  let total = 0;
  for (let i = 0; i < 10000000000; i++) {
    total += i;
  }

  console.log(`The total is ${total}`);
});

bgButton.addEventListener('click', () => {
  if (document.body.style.background !== 'green') {
    document.body.style.background = 'green';
  } else {
    document.body.style.background = 'blue';
  }
});
```

- Problem?
  - After clicking _Calculate Total_ Button, the browser will freeze & other button is not workable at this moment
- Workaround?
  - Use **Web Worker API**
  - Pass/deligate **CPU intensive work** to the **Web Worker API**
  - So, main thread will be free & other button will be workable at the same time

## Use Web Worker API

- JS script file:

```js
// Initial a worker
const worker = new Worker('worker.js');

const totalButton = document.getElementById('total');
const bgButton = document.getElementById('bg');

totalButton.addEventListener('click', () => {
  // Triggering worker by sending a message 
  worker.postMessage('Hello worker! Please do the work for me');
});

// Received a message from a worker
worker.onmessage = function (message) {
  console.log(`The total is ${message.data}`);
};

bgButton.addEventListener('click', () => {
  if (document.body.style.background !== 'green') {
    document.body.style.background = 'green';
  } else {
    document.body.style.background = 'blue';
  }
});
```

- JS worker file:

```js
onmessage = function (message) {
  console.log('Worker has started working...');

  let total = 0;
  for (let i = 0; i < 10000000000; i++) {
    total += i;
  }

  console.log('Worker has finished working...');

  postMessage(total);
};
```

## Interview Preparation

❓ যদি JS single-threaded হয়, তাহলে heavy computation এ browser “freeze” হয় কেন?

Answer:
কারণ CPU-heavy synchronous code call stack ব্লক করে রাখে।
Event loop queue থেকে কিছুই নিতে পারে না → UI ফ্রিজ হয়।
